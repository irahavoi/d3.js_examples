<!DOCTYPE html>
<html>
<head>
    <title>D3.js</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <!--<link rel="stylesheet" type="text/css" href="css/d3ia.css">-->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/network.css">
</head>
<body onload="forceDirectedNetwork()">
<div class="well">
    <div><svg style="width: 500px; height: 500px; border: 1px lightgray solid;"></svg></div>
    <div id="controls">
</div>
<script type="text/javascript">
          var force;
          var marker = d3.select("svg").append('defs')
            .append("marker")
            .attr("id", "Triangle")
            .attr("refX", 12)
            .attr("refY", 6)
            .attr("markerUnits", 'userSpaceOnUse')
            .attr("markerWidth", 12)
            .attr("markerHeight", 18)
            .attr("orient", 'auto')
            .append("path")
            .attr("d", 'M 0 0 12 6 0 12 3 6');

           function forceDirectedNetwork(){
              queue()
                .defer(d3.csv, "data/nodelist.csv")
                .defer(d3.csv, "data/edgelist.csv")
                .await(function(error, file1, file2){
                  createForceDirectedNetwork(file1, file2);
                });
           }

           function createForceDirectedNetwork(nodes, edges){
            var nodeHash = {};
            for(x in nodes){
              console.log(nodes[x].id)
              nodeHash[nodes[x].id] = nodes[x];
            }

            for(x in edges){
              edges[x].weight = parseInt(x.weight);
              edges[x].source = nodeHash[edges[x].source];
              edges[x].target = nodeHash[edges[x].target];
            }

            var weightScale = d3.scale.linear()
              .domain(d3.extent(edges, function(d){return d.weight}))
              .range([.1, 1]);

            force = d3.layout.force().charge(-1000)
              .size([500, 500])
              .nodes(nodes)
              .links(edges)
              .on("tick", forceTick);

            d3.select("svg").selectAll("line.link")
              .data(edges, function(d){
                return d.source.id + "-" +d.target.id ;
              })
              .enter()
              .append("line")
              .attr("class", "link")
              .style("stroke", "black")
              .style("opacity", .5)
              .style("stroke-width", function(d){return d.weight;});

            d3.selectAll("line").attr("marker-end", "url(#Triangle)");  

            d3.select("#controls")
              .append("button")
              .attr("class", "btn btn-success")
              .on("click", sizeByDegree)
              .html("Degree Size");


           var nodeEnter = d3.select("svg").selectAll("g.node")
            .data(nodes, function(d){return d.id;})
            .enter()
            .append("g")
            .attr("class", "node");

            nodeEnter.append("circle")
              .attr("r", 5)
              .style("fill", "lightgray")
              .style("stroke", "black")
              .style("stroke-width", "1px");

            nodeEnter.append("text")
              .style("text-anchor", "middle")
              .attr("y", 15)
              .text(function(d){return d.id;});







            force.start();   
            d3.selectAll("g.node").call(force.drag())

           }

           function forceTick(){
              d3.selectAll("line.link")
                .attr("x1", function(d){return d.source.x})
                .attr("x2", function(d){return d.target.x})
                .attr("y1", function(d){return d.source.y})
                .attr("y2", function(d){return d.target.y})

              d3.selectAll("g.node")
                .attr("transform", function(d){
                  return "translate(" + d.x + "," + d.y +")";
                })  
           }

           function sizeByDegree(){
            force.stop();
            d3.selectAll("circle")
              .attr("r", function(d){return d.weight * 2;})

            force.resume();  
           }



	</script>
</body>
</html>